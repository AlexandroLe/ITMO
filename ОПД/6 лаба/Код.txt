ORG 0x0
V0: WORD $default, 0X180
V1: WORD $default, 0X180
V2: WORD $int2,    0X180
V3: WORD $int3,    0x180
V4: WORD $default, 0X180
V5: WORD $default, 0X180
V6: WORD $default, 0X180
V7: WORD $default, 0X180

ORG 0x008
X: WORD 0x0000

max: WORD 0x003C		; 60, максимальное значение Х
min: WORD 0xFFBD 		; -67, минимальное значение Х
default:    IRET 		; Обработка прерывания по умолчанию

START:  	DI
    		CLA
    		LD #0xA	; Загрузка в аккумулятор MR (1000|0010 = 1010)
    		OUT 0x5 	; Разрешение прерываний для 2 ВУ
    		LD #0xB  	; Загрузка в аккумулятор MR (1000|0011 = 1011)
    		OUT 0x7 	; Разрешение прерываний для 3 ВУ
    		EI
main:   	DI 		; Запрет прерываний чтобы обеспечить атом. операции
   		LD X		; Загружаем Х
    		SUB #0x3	; Вычитаем 3 
   		CALL check
    		ST X
    		EI
    		JUMP main
int2:		HLT		; Обработка прерывания на ВУ-3
		PUSH 
		IN 4	 	; Загрузили РДВУ-2
		AND #0x07	; 
		AND X
		CALL check
		ST X		; Сохранили Х
		HLT		; Проверка работоспособности ВУ-2
		POP
		HLT
		IRET		; Возврат из обработки прерывания

int3: 	HLT		; Обработка прерывания на ВУ-3
  		PUSH		; Сохранение аккумулятора 
		LD X		; Загрузка Х
    		HLT		; Отладочная метка
		ASL		; F(x) = 2X
		ADD #0x7	; F(x) = 2X + 7
    		OUT 0x6
    		POP
		HLT		; Проверка работоспособности ВУ-3
    		IRET


; Подпрограмма проверки ОДЗ, принимает и возвращает число в аккумуляторе
check:  	CMP min		; Проверка принадлежности X к ОДЗ
		BLT check_bad	; Если строго меньше минимума то вне ОДЗ
		CMP max		
		BEQ check_ok	; Если строго больше минимума то вне ОДЗ
		BGE check_bad
check_ok:	RET
check_bad: 	LD  max		; Если больше либо меньше ОДЗ, то X = maxX
 		RET 
